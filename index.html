<!DOCTYPE html>
<html>
<head>
  <title>NEON PING PONG ULTRA</title>

  <!-- MOBILE FULLSCREEN (siap jadi APK) -->
  <meta name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="theme-color" content="#000000">

  <style>
    html,body{
      margin:0;
      padding:0;
      overflow:hidden;
      background:black;
      touch-action:none;
      user-select:none;
      -webkit-user-select:none;
    }
    canvas{
      display:block;
      width:100vw;
      height:100vh;
    }
  </style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const c=document.getElementById("game");
const ctx=c.getContext("2d");

function resize(){
  c.width=innerWidth;
  c.height=innerHeight;
}
resize();
addEventListener("resize",resize);

// ===== GAME STATE =====
let state="menu";
let highScore=localStorage.getItem("highScore")||0;

// ===== PLAYER =====
let paddleW=120,paddleH=15,paddleX=c.width/2-60;

// ===== BALL =====
let ballX=c.width/2, ballY=c.height/2;
let ballR=10;
let speedX=4,speedY=-4;

let score=0,combo=1,flash=0,levelText=0,bgMove=0;

let trails=[],particles=[],powerUps=[];

// ===== STARS =====
let stars=[];
for(let i=0;i<70;i++){
  stars.push({x:Math.random()*c.width,y:Math.random()*c.height,s:Math.random()*2+1});
}

// ===== RESET =====
function reset(){
  ballX=c.width/2;
  ballY=c.height/2;
  speedX=4;
  speedY=-4;
  ballR=10;
  paddleW=120;
  score=0;
  combo=1;
  trails=[]; particles=[]; powerUps=[];
}

// ===== BACKGROUND =====
function bg(){
  let g=ctx.createLinearGradient(0,bgMove,c.width,c.height+bgMove);
  g.addColorStop(0,"red");
  g.addColorStop(.5,"white");
  g.addColorStop(1,"pink");
  ctx.fillStyle=g;
  ctx.fillRect(0,0,c.width,c.height);

  bgMove++;
  if(bgMove>c.height) bgMove=-c.height;
}

function drawStars(){
  ctx.fillStyle="white";
  stars.forEach(s=>{
    ctx.globalAlpha=.7;
    ctx.fillRect(s.x,s.y,s.s,s.s);
    s.y+=0.5;
    if(s.y>c.height){s.y=0;s.x=Math.random()*c.width;}
  });
  ctx.globalAlpha=1;
}

// ===== DRAW OBJECT =====
function drawPaddle(){
  ctx.shadowBlur=20;
  ctx.shadowColor="white";
  ctx.fillStyle="white";
  ctx.fillRect(paddleX,c.height-30,paddleW,paddleH);
  ctx.shadowBlur=0;
}

function drawBall(){
  trails.push({x:ballX,y:ballY});
  if(trails.length>15) trails.shift();

  trails.forEach((t,i)=>{
    ctx.globalAlpha=i/trails.length;
    ctx.beginPath();
    ctx.arc(t.x,t.y,ballR,0,Math.PI*2);
    ctx.fillStyle="cyan";
    ctx.fill();
  });
  ctx.globalAlpha=1;

  ctx.shadowBlur=25;
  ctx.shadowColor="cyan";
  ctx.beginPath();
  ctx.arc(ballX,ballY,ballR,0,Math.PI*2);
  ctx.fillStyle="cyan";
  ctx.fill();
  ctx.shadowBlur=0;
}

// ===== UI =====
function drawUI(){
  ctx.fillStyle="white";
  ctx.font="20px Arial";
  ctx.fillText("Score: "+score,20,30);
  ctx.fillText("High: "+highScore,20,55);
  ctx.fillText("Combo x"+combo,20,80);
  ctx.fillText("â¸",c.width-40,35);

  if(levelText>0){
    ctx.font="35px Arial";
    ctx.textAlign="center";
    ctx.fillText("LEVEL UP!",c.width/2,c.height/2);
    ctx.textAlign="left";
    levelText--;
  }
}

// ===== PARTICLES =====
function spawnParticles(x,y){
  for(let i=0;i<8;i++){
    particles.push({
      x,y,
      vx:(Math.random()-0.5)*4,
      vy:(Math.random()-0.5)*4,
      life:30
    });
  }
}
function drawParticles(){
  particles.forEach(p=>{
    ctx.globalAlpha=p.life/30;
    ctx.fillStyle="cyan";
    ctx.fillRect(p.x,p.y,3,3);
    p.x+=p.vx; p.y+=p.vy;
    p.life--;
  });
  particles=particles.filter(p=>p.life>0);
  ctx.globalAlpha=1;
}

// ===== POWER UP =====
function spawnPowerUp(){
  const types=["bigball","longpaddle","slow"];
  powerUps.push({
    x:Math.random()*(c.width-30)+15,
    y:0,
    type:types[Math.floor(Math.random()*types.length)]
  });
}
function drawPowerUps(){
  powerUps.forEach(p=>{
    p.y+=2;
    ctx.fillStyle="yellow";
    ctx.beginPath();
    ctx.arc(p.x,p.y,12,0,Math.PI*2);
    ctx.fill();
  });

  powerUps = powerUps.filter(p=>p.y<c.height);

  powerUps.forEach(p=>{
    if(Math.abs(p.x-ballX)<20 && Math.abs(p.y-ballY)<20){
      if(p.type==="bigball") ballR=16;
      if(p.type==="longpaddle") paddleW=170;
      if(p.type==="slow"){speedX*=0.8;speedY*=0.8;}
      flash=10;
      p.y=c.height+100;
    }
  });
}

// ===== UPDATE =====
function update(){

  let slow=(ballY>c.height-150)?0.6:1;

  ballX+=speedX*slow;
  ballY+=speedY*slow;

  if(ballX+ballR>c.width||ballX-ballR<0) speedX*=-1;
  if(ballY-ballR<0) speedY*=-1;

  if(ballY+ballR>c.height-30 &&
     ballX>paddleX && ballX<paddleX+paddleW){

    speedY*=-1;
    score += combo;
    combo++;

    spawnParticles(ballX,ballY);

    if(navigator.vibrate) navigator.vibrate(40);

    if(score%10<combo){
      speedX += speedX>0?0.5:-0.5;
      speedY += speedY>0?0.5:-0.5;
      flash=10;
      levelText=60;
    }

    if(Math.random()<0.15) spawnPowerUp();

    if(score>highScore){
      highScore=score;
      localStorage.setItem("highScore",highScore);
    }
  }

  if(ballY>c.height) state="over";
}

// ===== SCREEN =====
function menu(){
  ctx.fillStyle="white";
  ctx.font="40px Arial";
  ctx.textAlign="center";
  ctx.fillText("NEON PING PONG",c.width/2,c.height/2-40);
  ctx.font="22px Arial";
  ctx.fillText("Tap untuk mulai",c.width/2,c.height/2+20);
  ctx.textAlign="left";
}
function over(){
  ctx.fillStyle="white";
  ctx.font="38px Arial";
  ctx.textAlign="center";
  ctx.fillText("GAME OVER",c.width/2,c.height/2-30);
  ctx.font="22px Arial";
  ctx.fillText("Score: "+score,c.width/2,c.height/2+10);
  ctx.fillText("Tap untuk ulang",c.width/2,c.height/2+45);
  ctx.textAlign="left";
}
function pause(){
  ctx.fillStyle="white";
  ctx.font="40px Arial";
  ctx.textAlign="center";
  ctx.fillText("PAUSED",c.width/2,c.height/2);
  ctx.textAlign="left";
}

// ===== LOOP =====
function loop(){
  bg();
  drawStars();

  if(flash>0){
    ctx.fillStyle="rgba(255,255,255,0.2)";
    ctx.fillRect(0,0,c.width,c.height);
    flash--;
  }

  if(state==="menu") menu();

  if(state==="play"){
    drawPaddle();
    drawBall();
    drawParticles();
    drawPowerUps();
    drawUI();
    update();
  }

  if(state==="pause"){
    drawPaddle(); drawBall(); drawUI(); pause();
  }

  if(state==="over") over();

  requestAnimationFrame(loop);
}
loop();

// ===== CONTROL =====
function tap(x,y){
  if(state==="play" && x>c.width-60 && y<50){state="pause";return;}
  if(state==="pause"){state="play";return;}
  if(state==="menu"){state="play";return;}
  if(state==="over"){reset();state="play";}
}

addEventListener("touchmove",e=>{
  paddleX=e.touches[0].clientX-paddleW/2;
});
addEventListener("mousemove",e=>{
  paddleX=e.clientX-paddleW/2;
});
addEventListener("touchstart",e=>{
  tap(e.touches[0].clientX,e.touches[0].clientY);
});
addEventListener("mousedown",e=>{
  tap(e.clientX,e.clientY);
});
</script>

</body>
</html>